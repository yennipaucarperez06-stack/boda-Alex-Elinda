<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
    <form action="" id="formulario">
         <label for="">Nombre</label>
         <input type="text" name="nombre">
             <label for="">Mensaje</label>
         <input type="text" name="mensaje">
         <button type="submit">enviar</button>
    </form>
  <div id="mostrar"></div>
      <script type="module">
  // Import the functions you need from the SDKs you need
   import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";

   import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      where,
      getDocs,
      orderBy,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyC65iEfPFGHEpu1Knqi7Qx4deF7G-eHmJA",
    authDomain: "deseos-80d43.firebaseapp.com",
    projectId: "deseos-80d43",
    storageBucket: "deseos-80d43.firebasestorage.app",
    messagingSenderId: "168948508828",
    appId: "1:168948508828:web:34d4fb432f12030ad1e559",
    measurementId: "G-TLQ32QN0XE"
  };
  

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

     const form = document.getElementById('formulario');
    const mostrarDiv = document.getElementById('mostrar');

    // 4️⃣ Guardar datos al enviar formulario
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        nombre: form.nombre.value.trim(),
        mensaje: form.mensaje.value.trim(),
        createdAt: serverTimestamp()
      };

      try {
        await addDoc(collection(db, "deseos"), data);
        form.reset();
      } catch (err) {
        console.error(err);
        alert("Error: " + err.message);
      }
    });

    // 5️⃣ Escuchar los datos guardados en tiempo real y mostrarlos
    const q = query(collection(db, "deseos"), orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
      mostrarDiv.innerHTML = ""; // limpiar antes de volver a renderizar

      snapshot.forEach((doc) => {
        const item = doc.data();
        const div = document.createElement('div');
        div.style.border = "1px solid #ccc";
        div.style.margin = "6px 0";
        div.style.padding = "6px";
        div.innerHTML = `
          <strong>${item.mensaje}</strong> (${item.nombre})<br>
          ${item.message}
        `;
        mostrarDiv.appendChild(div);
      });
    });
</script>
</body>
</html>